concrete-js
===========

**concrete-js** is a JavaScript library for working with  [Concrete](https://github.com/hltcoe/concrete), a set of NLP data types defined by a [Thrift](https://thrift.apache.org) schema.

The **concrete-js** library contains JavaScript code generated by the Thrift compiler, plus some utility functions for manipulating Concrete objects.


Using concrete-js
-----------------

Copy the files ```dist/thrift.js``` and ```dist/concrete.js``` to your project, and include the scripts from your HTML files using:

    <script src="thrift.js"></script>
    <script src="concrete.js"></script>

Converting Communications to/from JSON
--------------------------------------

Concrete Communications can be converted to/from JSON using Thrift's
TJSONProtocol serialization format.  Thrift RPC calls transmit Thrift
objects (such as Communications) using the TJSONProtocol format.

The `Communication` class in **concrete-js** has been extended with
some helper functions for working with TJSONProtocol.  These are
helpful if you want to pass TJSONProtocol serialized Communications
around without using Thrift RPC calls.

```
var comm = new Communication();
var comm_as_json_object = comm.toTJSONProtocolObject();
var comm_as_json_string = comm.toTJSONProtocolString();

var comm2 = new Communication();
comm2.initFromTJSONProtocolObject(comm_as_json_object);

var comm3 = new Communication();
comm3.initFromTJSONProtocolString(comm_as_json_string);
```


Building concrete-js
--------------------

You do not need to build **concrete-js** in order to use **concrete-js** - a working copy of the library is included in the ```dist/``` directory.  The **concrete-js** library only needs to (re)built when the Thrift schema files for Concrete have been updated, or when you update the utility functions.

Requirements for building **concrete-js**:

* A copy of the [Concrete](https://github.com/hltcoe/concrete) repo in your home directory - ```${HOME}/concrete```
* [Thrift](https://thrift.apache.org)
* [Node](http://nodejs.org)
* [Grunt](http://gruntjs.com) - a JavaScript build tool

Install the Node packages required for building **concrete-js** using:

    npm install

Build **concrete-js** using the command:

    grunt

which will:

* call the Thrift compiler to generate JavaScript code for the Thrift schema under ```${HOME}/concrete```
* combine the Thrift-generated JavaScript code with the hand-written utility function JavaScript code
* run [JSHint](http://www.jshint.com) on the combined JavaScript code to check for problems
* minify the combined code
* download the latest version of ```thrift.js``` from the Apache Thrift repository
