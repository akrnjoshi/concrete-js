<!DOCTYPE html>
<html lang="en">
<head>
  <title>concrete-js examples</title>
  <meta charset='UTF-8'>

  <link rel="stylesheet" href="bootstrap-3.2.0/css/bootstrap.css"/>
  <link rel="stylesheet" href="bootstrap-3.2.0/css/bootstrap-theme.css"/>
  <link rel="stylesheet" href="examples.css"/>

  <script src="jquery-1.11.1.js"></script>
  <script src="bootstrap-3.2.0/js/bootstrap.js"></script>

  <script src="../dist/thrift.js"></script>
  <script src="../dist/concrete.js"></script>

  <script>
  /**
   * toggleSelectedEntityClass() is a callback function that is used
   * with getTokenClickCallbacks()/enableTokenClickCallbacks() and
   * getTokenSelectCallbacks()/enableTokenClickCallbacks().
   *
   * When a user clicks on a token or selects token(s), this
   * function will be called and passed a list of
   * TokenRefSequences containing the token(s) clicked/selected.
   *
   * @param {TokenRefSequence[]} tokenRefSequenceList
   */
  function toggleSelectedEntityClass(tokenRefSequenceList) {
    for (var i in tokenRefSequenceList) {

      $('#communication_one').getTokenRefSequenceElements(tokenRefSequenceList[i])
                             .toggleClass('selected_entity');
    }
  }

  // When the page has loaded...
  $(document).ready(function() {
    // ...make an AJAX call to retrieve a JSON-serialized Communication...
    $.getJSON('dog-bites-man.concrete.json', function(commJSONData) {
      // ...and call this (unnamed) callback function with the JSON data.

      //// Token highlighting demo

      // Create an empty Concrete Communication object
      var commOne = new Communication();

      // Load the JSON-serialized Communication data into the Communication object
      commOne.initFromTJSONProtocolObject(commJSONData);

      // Create a "Communication Widget" that is an HTML representation of the
      // Sections, Sentences, Tokenizations, and Tokens in the Communication.
      // Attach this HTML representation to the <div> with ID 'communication_one'.
      var commWidgetOne = $('#communication_one').communicationWidget(commOne);

      // Register a callback function when the user clicks on or selects a token
      // from this Communication Widget.
      commWidgetOne.getTokenClickCallbacks().add(toggleSelectedEntityClass);
      commWidgetOne.getTokenSelectCallbacks().add(toggleSelectedEntityClass);

      // Activate any registered callback functions for handling clicking or
      // selecting tokens
      commWidgetOne.enableTokenClickCallbacks();
      commWidgetOne.enableTokenSelectCallbacks();


      //// Token tagging demo
      var commTwo = new Communication();
      commTwo.initFromTJSONProtocolObject(commJSONData);
      var commWidgetTwo = $('#communication_two').communicationWidget(commTwo);

      var tokenizations = commTwo.getTokenizationsAsList();
      for (var tokenizationIndex = 0; tokenizationIndex < tokenizations.length; tokenizationIndex++) {
        var tokenization = tokenizations[tokenizationIndex];

        var posTokenTagging = tokenization.getTokenTaggingsOfType('POS')[0];

        // Add a Bootstrap tooltip with POS tag to each Token element
        if (posTokenTagging) {
          var allTokenElements = commWidgetTwo.getTokenElements(tokenization);
          allTokenElements.each(function() {
            // communicationWidget() uses jQuery's data() function to store the
            // tokenization and tokenIndex associated with each Token element
            var tokenization = $(this).data('tokenization');
            var tokenIndex = $(this).data('tokenIndex');

            // posTokenTagging is defined in enclosing scope
            var taggedToken = posTokenTagging.getTaggedTokenWithTokenIndex(tokenIndex);

            if (taggedToken) {
              // By default, the tooltip is only shown when mousing over the token text.
              //   http://getbootstrap.com/javascript/#tooltips
              $(this).attr('data-placement', 'auto top')
                     .attr('title', taggedToken.tag)
                     .tooltip();
            }
          });
        }
      }

      //// Token filtering demo
      var commThree = new Communication();
      commThree.initFromTJSONProtocolObject(commJSONData);
      var commWidgetThree = $('#communication_three').communicationWidget(commThree);

      var tokenizations = commThree.getTokenizationsAsList();
      for (var tokenizationIndex = 0; tokenizationIndex < tokenizations.length; tokenizationIndex++) {
        var tokenization = tokenizations[tokenizationIndex];

        var posTokenTagging = tokenization.getTokenTaggingsOfType('POS')[0];

        var matchingTokenElements = commWidgetThree.getTokenElementsWithMatchingTag(
          tokenization,
          posTokenTagging,

          // Filter function returns a boolean if a TaggedToken.tag string "matches"
          function(tagText) {
            return tagText.substring(0,1) === 'N';
          }
        );
        matchingTokenElements.addClass('selected_entity');
      }
    });
  });
  </script>
</head>
<body>
  <div class="container-fluid">
    <div>
      <h2>Token highlighting</h2>
      <div>
        Click or drag-to-select tokens to toggle highlighting:
      </div>
      <div class="communication_container">
        <div id="communication_one"></div>
      </div>
    </div>

    <hr />

    <div>
      <h2>Token tagging</h2>
      <div>
        Mouse over a token to see the POS tag for that token:
      </div>
      <div class="communication_container">
        <div id="communication_two"></div>
      </div>
    </div>

    <hr />

    <div>
      <h2>Token filtering</h2>
      <div>
        Use <code>getTokenElementsWithMatchingTag()</code> to
        select elements with a POS tag starting with the letter 'N':
      </div>
      <div class="communication_container">
        <div id="communication_three"></div>
      </div>
    </div>
  </div>
</body>
</html>
